<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <!-- Spring Boot'un temel logback yapılandırmasını dahil et -->
    <include resource="org/springframework/boot/logging/logback/base.xml"/>

    <!-- JSON Console Appender -->
    <appender name="CONSOLE_JSON" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LogstashEncoder">
            <!-- Kod içerisinde MDC'ye manuel ekleme yapmadan traceId ve spanId ekler -->
            <!-- Spring Boot 3 ve sonrası için bu alanlar otomatik olarak loglara dahil edilir -->
            <!-- includeMdcKeyName>traceId</includeMdcKeyName -->
            <!-- includeMdcKeyName>spanId</includeMdcKeyName -->

            <!-- JSON çıktısındaki alan isimlerini özelleştirebilirsiniz -->
            <fieldNames>
                <timestamp>timestamp</timestamp>
                <version>[ignore]</version> <!-- Logstash format version, ignore if not needed -->
                <level>level</level>
                <thread>thread</thread>
                <logger>logger</logger>
                <message>message</message>
                <stackTrace>stack_trace</stackTrace>
                <!-- Otomatik eklenen tracing alanları genellikle traceId ve spanId olur -->
            </fieldNames>

             <!-- Uygulama adını her log kaydına ekle -->
            <customFields>{"app_name":"${springAppName:-mall-service}"}</customFields>

        </encoder>
    </appender>

    <!-- Belirli paketler için log seviyesi ayarlaması -->
    <!-- logger name="com.avmerkez" level="DEBUG"/ -->
    <!-- logger name="org.springframework.web" level="INFO"/ -->

    <!-- Kök logger'ı ayarla -->
    <root level="INFO"> <!-- Varsayılan seviye INFO -->
        <appender-ref ref="CONSOLE_JSON" /> <!-- Sadece JSON console appenderı kullan -->
        <!-- appender-ref ref="CONSOLE" / --> <!-- Springin varsayılan konsol appenderını kaldırmak için yorum satırı yapın -->
    </root>

    <!-- Spring Profilea göre farklı yapılandırmalar (opsiyonel) -->
    <!--
    <springProfile name="dev">
        <root level="DEBUG">
            <appender-ref ref="CONSOLE_JSON" />
        </root>
    </springProfile>

    <springProfile name="prod">
        <root level="INFO">
            <appender-ref ref="CONSOLE_JSON" />
        </root>
    </springProfile>
    -->

</configuration> 